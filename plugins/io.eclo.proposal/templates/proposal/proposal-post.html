<div class="container pb-5 mb-5">
    <div class="mb-3 d-flex justify-content-between align-items-center">
        <div>
            <h4 class="mb-0 fw-bold text-body"><?=$title?></h4>
            <ul class="breadcrumb small mb-0">
                <li class="breadcrumb-item small">
                    <a href="/" class="pjax-load link-secondary"><?=$jatbi->lang("Trang chủ")?></a>
                </li>
                <li class="breadcrumb-item small text-body" aria-current="page"><?=$title?></li>
            </ul>
        </div>
        <div class="text-body">
            <strong><?=$jatbi->lang("Đã lưu nháp")?>:</strong>
            <?=$jatbi->datetime($data['modify'])?>          
        </div>
    </div>
    <div class="row g-5">
        <div class="col-lg-6">
            <div class="card bg-body shadow-lg border-0 bg-opacity-50 rounded-4 h-100">
                <div class="card-body">
                    <h6 class="fw-bold"><?=$jatbi->lang("Thông tin đề xuất")?></h6>
                    <div class="row">
                        <div class="col-lg-6">
                            <?=$app->component('select',[
                                "name"=>'type',
                                "placeholder"=>$jatbi->lang("Đề xuất"),
                                "selected" => $data['type'] ?? '',
                                "attr" => 'data-width="100%" data-action="change" data-url="/proposal/update/'.$data['active'].'" data-form=\'{"type":"type","value":"this.val"}\'',
                                "id" => "type",
                                "options" => $types,
                                "required" => 'true',
                            ])?>
                            <?=$app->component('select',[
                                "name"=>'form',
                                "placeholder"=>$jatbi->lang("Hình thức"),
                                "selected" => $data['form'] ?? '',
                                "attr" => 'data-width="100%" data-select-load="true" data-parent="#type" data-select-url="/proposal/search/form" data-method="POST" data-keyword="keyword" data-action="change" data-url="/proposal/update/'.$data['active'].'" data-form=\'{"type":"form","value":"this.val"}\'',
                                "id" => "form",
                                "options" => $forms,
                                "required" => 'true',
                            ])?>
                            <?=$app->component('select',[
                                "name"=>'workflows',
                                "placeholder"=>$jatbi->lang("Quy trình"),
                                "selected" => $data['workflows'] ?? '',
                                "attr" => 'data-width="100%" data-select-load="true"  data-parent="#form" data-select-url="/proposal/search/workflows" data-method="POST" data-keyword="keyword" data-action="change" data-url="/proposal/update/'.$data['active'].'" data-form=\'{"type":"workflows","value":"this.val"}\'',
                                "id" => "workflows",
                                "options" => $workflows,
                                "required" => 'true',
                            ])?>
                            <?=$app->component('select',[
                                "name"=>'category',
                                "placeholder"=>$jatbi->lang("Hạng mục"),
                                "selected" => $data['category'] ?? '',
                                "attr" => 'data-width="100%" data-select-load="true"  data-parent="#workflows" data-select-url="/proposal/search/categorys" data-method="POST" data-keyword="keyword" data-action="change" data-url="/proposal/update/'.$data['active'].'" data-form=\'{"type":"category","value":"this.val"}\'',
                                "id" => "category",
                                "options" => $categorys,
                                "required" => 'true',
                            ])?>
                            <?=$app->component('input',[
                                "name"=>'target',
                                "placeholder"=>$jatbi->lang("Mục tiêu"),
                                "value" => $data['target'] ?? '',
                                "class" => 'filter-name',         
                                "type" => "text",
                                "required" => 'true',
                                "attr" => 'data-action="blur" data-url="/proposal/update/'.$data['active'].'" data-form=\'{"type":"target","value":"this.val"}\' ',
                            ])?>
                            <?=$app->component('input',[
                                "name"=>'date',
                                "placeholder"=>$jatbi->lang("Ngày"),
                                "value" => $data['date'] ?? date("Y-m-d"),
                                "class" => 'filter-name',         
                                "type" => "date",
                                "required" => 'true',
                                "attr" => 'data-action="blur" data-url="/proposal/update/'.$data['active'].'" data-form=\'{"type":"date","value":"this.val"}\' ',
                            ])?>
                        </div>
                        <div class="col-lg-6">
                            <?=$app->component('select',[
                                "name"=>'customers',
                                "placeholder"=>$jatbi->lang("Khách hàng"),
                                "selected" => $data['customers'] ?? '',
                                "attr" => 'data-width="100%" data-select-load="true" data-select-url="/customers/search" data-method="POST" data-keyword="keyword" data-action="change" data-url="/proposal/update/'.$data['active'].'" data-form=\'{"type":"customers","value":"this.val"}\'',
                                "id" => "customers",
                                "options" => $customers,
                            ])?>
                            <?=$app->component('select',[
                                "name"=>'vendors',
                                "placeholder"=>$jatbi->lang("Nhà cung cấp"),
                                "selected" => $data['vendors'] ?? '',
                                "attr" => 'data-width="100%" data-select-load="true" data-select-url="/proposal/search/vendors" data-method="POST" data-keyword="keyword" data-action="change" data-url="/proposal/update/'.$data['active'].'" data-form=\'{"type":"vendors","value":"this.val"}\'',
                                "id" => "vendors",
                                "options" => $vendors,
                            ])?>
                            <?=$app->component('select',[
                                "name"=>'accounts',
                                "placeholder"=>$jatbi->lang("Nhân viên"),
                                "selected" => $data['accounts'] ?? '',
                                "attr" => 'data-width="100%" data-select-load="true" data-select-url="/proposal/search/accounts" data-method="POST" data-keyword="keyword" data-action="change" data-url="/proposal/update/'.$data['active'].'" data-form=\'{"type":"accounts","value":"this.val"}\'',
                                "id" => "accounts",
                                "options" => $accounts,
                            ])?>
                            <?=$app->component('select',[
                                "name"=>'proposals',
                                "placeholder"=>$jatbi->lang("Kèm đề xuất"),
                                "selected" => $data['proposals'] ?? '',
                                "attr" => 'data-width="100%" data-select-load="true" data-select-url="/proposal/search/proposals" data-method="POST" data-keyword="keyword" data-action="change" data-url="/proposal/update/'.$data['active'].'" data-form=\'{"type":"proposals","value":"this.val"}\'',
                                "id" => "proposals",
                                "options" => $proposals,
                            ])?>
                            <?=$app->component('select',[
                                "name"=>'accountants',
                                "placeholder"=>$jatbi->lang("Chứng từ"),
                                "selected" => $data['accountants'] ?? '',
                                "attr" => 'data-width="100%" disabled',
                                "id" => "accountants",
                                "options" => $accountants,
                            ])?>
                            <?=$app->component('select',[
                                "name"=>'brands',
                                "placeholder"=>$jatbi->lang("Chi nhánh"),
                                "selected" => $data['brands'] ?? '',
                                "attr" => 'data-width="100%" data-select-load="true" data-select-url="/proposal/search/brands" data-method="POST" data-keyword="keyword" data-action="change" data-url="/proposal/update/'.$data['active'].'" data-form=\'{"type":"brands","value":"this.val"}\'',
                                "id" => "brands",
                                "options" => $brands,
                            ])?>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card bg-body shadow-lg border-0 bg-opacity-50 rounded-4 h-100">
                <div class="card-body">
                    <h6 class="fw-bold"><?=$jatbi->lang("Thông tin số tiền")?></h6>
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="row">
                                <div class="col-6">
                                    <?=$app->component('input',[
                                        "name"=>'price',
                                        "placeholder"=>$jatbi->lang("Số tiền"),
                                        "value" => $data['price'] ?? '',
                                        "class" => 'filter-name',         
                                        "type" => "tel",
                                        "required" => 'true',
                                        "attr" => 'data-action="blur" data-update-price data-selector="[data-vat-price]" data-load="this" data-number="money" data-currency="" data-decimals="0" data-thousands="," data-decimal="." data-url="/proposal/update/'.$data['active'].'" data-form=\'{"type":"price","value":"this.val"}\' ',
                                    ])?>
                                </div>
                                <div class="col-6">
                                    <?=$app->component('select',[
                                        "name"=>'vat_type',
                                        "placeholder"=>$jatbi->lang("Loại thuế"),
                                        "selected" => $data['vat_type'] ?? '',
                                        "attr" => 'data-width="100%"  data-selector="[data-vat-price]" data-load="this" data-action="change"  data-url="/proposal/update/'.$data['active'].'" data-form=\'{"type":"vat_type","value":"this.val"}\'',
                                        "id" => "vat_type",
                                        "options" => [
                                            ["value" => 0, "text" => $jatbi->lang("Chưa bao gồm Thuế") ],
                                            ["value" => 1, "text" => $jatbi->lang("Đã gồm Thuế") ],
                                        ],
                                    ])?>
                                </div>
                                <div class="col-6">
                                    <?=$app->component('input',[
                                        "name"=>'vat_percent',
                                        "placeholder"=>$jatbi->lang("% Thuế"),
                                        "value" => $data['vat_percent'] ?? '',
                                        "class" => 'filter-name',         
                                        "type" => "tel",
                                        "attr" => 'data-action="blur" data-selector="[data-vat-price]" data-load="this"  data-selector="[data-vat-price]" data-url="/proposal/update/'.$data['active'].'" data-form=\'{"type":"vat_percent","value":"this.val"}\' ',
                                    ])?>
                                </div>
                                <div class="col-6">
                                    <?=$app->component('input',[
                                        "name"=>'vat_price',
                                        "placeholder"=>$jatbi->lang("Thành tiền thuế"),
                                        "value" => number_format($data['vat_price'] ?? ''),
                                        "class" => 'filter-name',         
                                        "type" => "tel",
                                        "attr" => 'data-vat-price disabled',
                                    ])?>
                                </div>
                            </div>
                            <?=$app->component('textarea',[
                                "name"=>'content',
                                "placeholder"=>$jatbi->lang("Diễn giải"),
                                "value" => $data['content'] ?? '',
                                "required" => 'true',
                                "attr" => 'data-action="blur" data-url="/proposal/update/'.$data['active'].'" data-form=\'{"type":"content","value":"this.val"}\' ',
                            ])?>
                            <?=$app->component('textarea',[
                                "name"=>'notes',
                                "placeholder"=>$jatbi->lang("Ghi chú"),
                                "value" => $data['notes'] ?? '',
                                "attr" => 'data-action="blur" data-url="/proposal/update/'.$data['active'].'" data-form=\'{"type":"notes","value":"this.val"}\' ',
                            ])?>
                            <?=$app->component('input',[
                                "name"=>'tags',
                                "placeholder"=>$jatbi->lang("Tags"),
                                "value" => $data['tags'] ?? '',
                                "class" => 'filter-name',         
                                "type" => "text",
                                "attr" => 'data-action="blur" data-url="/proposal/update/'.$data['active'].'" data-form=\'{"type":"tags","value":"this.val"}\' ',
                            ])?>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-12">
            <div class="card bg-body shadow-lg border-0 bg-opacity-50 rounded-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <strong class="d-block"><?=$jatbi->lang("Chi tiết thêm")?></strong>
                        <div>
                            <button type="button" class="btn btn-sm btn-eclo rounded-3 py-1 px-2 ms-2 d-flex align-items-center justify-content-center" data-action="click" data-url="/proposal/update/<?=$data['active']?>" data-toast="true"  data-table-load="datatable-details" data-form='{"type":"details","code":"create"}'><i class="ti ti-plus fs-4"></i> <?=$jatbi->lang("Thêm")?></button>
                        </div>
                    </div>
                    <table id="datatable-details" 
                            data-table 
                            class="table align-middle" 
                            data-type="POST" 
                            data-server="true" 
                            data-processing="true" 
                            data-page-length="10"
                            data-searching="true"
                            data-paging="true"
                            data-state-save='true'
                            style="width:100%">
                        <thead>
                            <tr>
                                <th data-name="type" data-orderable="true" class="text-nowrap text-start" data-visible="true" data-class=""><?=$jatbi->lang("Loại")?></th>
                                <th data-name="content" data-orderable="true" class="text-nowrap text-start" data-visible="true" data-class=""><?=$jatbi->lang("Nội dung")?></th>
                                <th data-name="price" data-orderable="true" class="text-nowrap text-start" data-visible="true" data-class=""><?=$jatbi->lang("Đơn giá")?></th>
                                <th data-name="amount" data-orderable="false" class="text-nowrap " data-visible="true" data-class=""><?=$jatbi->lang("Số lượng")?></th>
                                <th data-name="units" data-orderable="false" class="text-nowrap " data-visible="true" data-class=""><?=$jatbi->lang("Đơn vị")?></th>
                                <th data-name="total" data-orderable="false" class="text-nowrap " data-visible="true" data-class=""><?=$jatbi->lang("Thành tiền")?></th>
                                <th data-name="notes" data-orderable="false" class="text-nowrap " data-visible="true" data-class=""><?=$jatbi->lang("Ghi chú")?></th>
                                <th data-name="action" data-orderable="false" class="text-nowrap " data-visible="true" data-class="text-end"></th>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th data-name="total"></th>
                                <th data-name="update"></th>
                                <th></th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-lg-12">
            <div class="card bg-body shadow-lg border-0 bg-opacity-50 rounded-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <strong class="d-block"><?=$jatbi->lang("Chứng từ kèm theo")?></strong>
                        <div>
                            <a class="btn btn-sm btn-eclo rounded-3 py-1 px-2 ms-2 d-flex align-items-center justify-content-center" href="#" data-action="modal" data-url="<?=$jatbi->url('/files/upload/main?type=proposal&proposal='.$data['active'])?>"><i class="ti ti-plus fs-4"></i> <?=$jatbi->lang("Tải tệp lên")?></a>
                        </div>
                    </div>
                    <div class="row g-4 mt-4">
                        <?php foreach($files as $file){ ?>
                            <div class="col-lg-3">
                                <div class="btn card p-2 rounded-4 shadow border-0 h-100" data-action="modal" data-url="/files/files-views/<?=$file['active']?>">
                                    <span class="file-icon me-2 rounded-3 lazyload mb-4" data-bgset="<?=$jatbi->getFileIcon($file['active'])?>" style="--width:100%;--height:200px;"></span>
                                    <strong><?=$file['name']?></strong>
                                </div>
                            </div>
                        <?php } ?>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="position-fixed bottom-0 start-0 w-100 bg-body py-2 pb-standalone">
        <div class="text-center text-md-right">
            <button class="btn btn-danger text-light mx-2 fw-bold" data-load="/proposal/list/draft/" data-confirm="true" data-url="/proposal/proposal-update/5061/cancel/">Xóa bản nháp</button>
            <button class="btn btn-success text-light mx-2 fw-bold" data-action="modal" data-url="/proposal/completed/<?=$data['active']?>">Gửi đề xuất</button>
        </div>
    </div>
</div>