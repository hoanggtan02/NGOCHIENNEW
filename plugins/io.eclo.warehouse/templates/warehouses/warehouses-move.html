<div class="container" data-pos-this>
    <div class="mb-3 d-flex justify-content-between align-items-center">
        <div>
            <h4 class="mb-0 fw-bold text-body">
                <?=$title?>
            </h4>
            <ul class="breadcrumb small mb-0">
                <li class="breadcrumb-item small">
                    <a href="<?=$jatbi->url('/')?>" data-pjax class="link-secondary"><?=$jatbi->lang("Trang chủ")?></a>
                </li>
                <li class="breadcrumb-item small text-body" aria-current="page">
                    <?=$title?>
                </li>
            </ul>
        </div>
    </div>
    <div class="row g-2">
        <div class="col-lg-3">
            <div class="card">
                <div class="card-body">
                    <div class="mb-3">
                        <?php if(count($store_options) > 1): ?>
                            <?=$app->component('select', [
                                'name' => 'stores',
                                'placeholder' => $jatbi->lang("Chuyển từ cửa hàng"),
                                'required' => true,
                                'options' => $stores,
                                'selected' => $data['stores']['id'] ?? '',
                                'class' => 'change-update',
                                "attr" => 'data-action="change" data-load = "this"
                                    data-url="/warehouses/warehouses-update-2/'.$action.'/stores" 
                                    data-form=\'{"value": "this.val"}\''
                            ])?>
                        <?php endif; ?>
                    </div>
                    <div class="mb-3">
                        <?=$app->component('select',[
                            "name"=>'branch',
                            'required' => true,
                            "placeholder"=>$jatbi->lang("Quầy hàng Chuyển"),
                            "selected" =>($data['branch']['id'] ?? ''),
                            "options" => $branchs,
                            "attr" => 'data-width="100%"
                                        data-load="this" 
                                        data-action="change" 
                                        data-url="/warehouses/warehouses-update-2/'.$action.'/branch" 
                                        data-form=\'{"value": "this.val"}\' ',
                        ])?>
                    </div>
                    <div class="mb-3">
                        <?=$app->component('select', [
                            'name' => 'stores_receive',
                            'placeholder' => $jatbi->lang("Chuyển đến cửa hàng"),
                            'required' => true,
                            'options' => $stores_full,
                            'selected' => $data['stores_receive']['id'] ?? '',
                            'class' => 'change-update',
                            'id' => 'stores_receive',
                            "attr" => 'data-action="change" data-load = "this"
                                data-url="/warehouses/warehouses-update-2/'.$action.'/stores_receive" 
                                data-form=\'{"value": "this.val"}\''

                        ])?>
                    </div>
                    <div class="mb-3">
                        <?=$app->component('select',[
                            "name"=>'branch',
                            "placeholder"=>$jatbi->lang("Quầy hàng nhận"),
                            "selected" =>($data['branch_receive']['id'] ?? ''),
                            "options" => $getbranchs,
                            'required' => true,
                            "attr" => 'data-width="100%"
                                data-load="this" data-action="change" 
                                data-url="/warehouses/warehouses-update-2/'.$action.'/branch_receive" 
                                data-form=\'{"value": "this.val"}\'',
                            "id" => "branch_receive", 
                        ])?>
                    </div>
                    <div class="mb-3">
                        <?=$app->component('input',[
                            "type" => "date",
                            "name"=>'date',
                            'required' => true,
                            "placeholder"=>$jatbi->lang("Ngày"),
                            "value" => $data['date'] ??  date('d/m/Y'),
                            "class" => 'filter-name',
                            "attr" => 'data-width="100%" data-load = "this"
                                        data-action = "blur" data-form=\'{"value": "this.val"}\'
                                        data-url="/warehouses/warehouses-update-2/'.$action.'/date"',
                        ])?>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-9">
            <div class="card">
                <div class="card-body">
                    <div class="mb-3">
                        <div class="bg-body rounded-pill p-2 d-flex justify-content-center align-items-center" data-pos-table>
                            <i class="ti ti-search fs-3 ms-2"></i>
                            <div class="w-100" data-search="true" data-url="/warehouses/products-move">
                                <input type="text"
                                    class="form-control bg-transparent border-0 shadow-none py-3 w-100"
                                    placeholder="Tìm kiếm">
                                <div class="search-results-box rounded-4 shadow bg-body border-0 position-absolute max-height scroll-y w-100 z-3"
                                    style="--max-height:300px;"></div>
                                <template class="search-item-template">
                                    <div class="search-item border-0 py-2 btn text-start position-relative"
                                        style="display: flex; align-items: center; gap: 10px;">
                                        <div data-attr-products="value">
                                            <strong data-name="text"></strong><br>
                                            <a data-action="click" data-load="this"
                                                data-selector="[data-pos-table]"
                                                data-attr-url="url" class="stretched-link" href="#!"></a>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover table-striped table-bordered align-middle">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>Mã sản phẩm</th>
                                    <th>sản phẩm</th>
                                    <th>Nhà cung cấp</th>
                                    <th>Số lượng</th>
                                    <th>Đơn vị</th>
                                    <th>Đơn giá</th>
                                    <th>Ghi chú</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody data-pos-table>
                                <?php 
                                $stt = 0;
                                $sum_sl = 0;
                                foreach ($SelectProducts as $key => $SelectProduct) {
                                    $stt+=0;  
                                    $getPro = $app->get("products",["id","code","name","vendor","units","amount","price"],["id"=>$SelectProduct['products']]);
                                    $sum_sl += $SelectProduct['amount']; 
                                ?>
                                <tr>
                                    <td class="p-2"><?= ++$stt?></td>
                                    <td class="p-2"><?=$getPro['code']?></td>
                                    <td class="p-2"><?=$getPro['name']?></td>
                                    <td class="p-2"><?=$app->get("vendors","name",["id"=>$getPro['vendor']])?></td>
                                    <td class="p-2">
                                        <div class="input-group">
                                            <input type="text" name="amount"
                                                data-action="blur"
                                                data-form='{"value": "this.val"}'
                                                class="form-control blur-update border-0 p-2 bg-transparent"
                                                data-selector="[data-pos-table]"
                                                data-url="/warehouses/warehouses-update-2/<?=$action?>/products/amount/<?=$key?>"
                                                value="<?=$SelectProduct['amount']?>"
                                                data-load="this" min="0">

                                            <span class="input-group-text"><?=$getPro['amount']?></span>
                                        </div>

                                    </td>
                                    <td class="p-2"><?=$app->get("units","name",["id"=>$getPro['units']])?></td>
                                    <td class="p-2"><?=number_format($getPro['price'])?></td>
                                    <td class="p-2">
                                        <input type="text" name="notes" data-action="blur" data-selector="[data-pos-table]"
                                                class="blur-update border-0 w-100  h-100 p-2 bg-transparent" data-form='{"value": "this.val"}'
                                                data-url="/warehouses/warehouses-update-2/<?=$action?>/products/notes/<?=$key?>" 
                                                value="<?=$SelectProduct['notes']?>" data-load="this">
                                    </td>
                                    <td class="text-center">
                                        <a class="click-update text-danger" data-load="this" data-action="click"
                                            data-alert="true" data-selector="[data-pos-table]"
                                            data-url="/warehouses/warehouses-update-2/<?=$action?>/products/deleted/<?=$key?>">
                                            <i class="ti ti-trash"></i>
                                        </a>
                                    </td>
                                </tr>
                                <?php } ?>
                            </tbody>
                        </table>
                    </div>
                    <div class="mb-3">
                        <?=$app->component('textarea', [
                            "name" => "content",
                            "placeholder" => $jatbi->lang("Nội dung"),
                            "value" => $data['content'] ?? '',
                            "attr" => 'style="height: 100px;"
                                        data-action = "blur" data-load = "this" data-form=\'{"value": "this.val"}\'
                                        data-url="/warehouses/warehouses-update-2/'.$action.'/content"',
                            "required" => true,
                        ])?>
                    </div>
                </div>
                    <div class="card-footer text-end bg-light border-0">
                        <a 
                            class="btn btn-eclo-light py-3 rounded-4 me-2" 
                            data-load="this" data-action="modal"
                            data-url="/warehouses/warehouses-updatee-2/move/cancel"
                        >Hủy</a>
                        <a 
                            class="btn btn-danger py-3 rounded-4 me-2" 
                            data-load="this" data-action="modal" data-alert="true"
                            data-url="/warehouses/warehouses-update-2/move/completed/moves"
                        >Hoàn tất</a>
                    </div>
            </div>
        </div>
    </div>
</div>