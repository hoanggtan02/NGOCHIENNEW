<div class="modal fade modal-load" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content rounded-4 border-0 shadow">
               <div class="modal-header d-print-none">
                <h5 class="modal-title">
                    <?php echo htmlspecialchars($title); ?>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="d-flex justify-content-between text-dark">
                    <div class="fw-bold text-uppercase" style="width: 60%;">
                        <h6 class="p-0 m-0">CÔNG TY TNHH MỘT THÀNH VIÊN NGỌC TRAI NGỌC HIỀN PHÚ QUỐC</h6>
                    </div>
                    <div class="text-center" style="width: 40%;"><strong>Mẫu số 01 - VT</strong>
                        <h6 class="small"><i>(Ban hành theo Thông tư số 133/2016/TT-BTC Ngày 26/08/2016 của bộ Tài
                                Chính)</i></h6>
                    </div>
                </div>

                <div class="text-center text-dark my-3">
                    <h4 class="text-dark fw-bold">
                        <?php
                            $types = ['import' => 'PHIẾU NHẬP HÀNG', 'return' => 'PHIẾU TRẢ HÀNG', 'move' => 'PHIẾU CHUYỂN HÀNG', 'pairing' => 'CHỈNH SỬA SẢN PHẨM', 'export' => 'PHIẾU XUẤT HÀNG', 'remove' => 'PHIẾU CHUYỂN VỀ CHẾ TÁC', 'delete' => 'PHIẾU HỦY HÀNG', 'error' => 'PHIẾU HÀNG LỖI'];
                            echo $types[$data['type']] ?? 'PHIẾU KHO';
                        ?>
                    </h4>
                    <h6><i><?=$jatbi->lang("Ngày")?>:
                            <?=date($setting['site_date'] ?? 'd/m/Y', strtotime($data['date']))?>
                        </i></h6>
                </div>

                <table class="table table-borderless table-sm small mb-3 text-dark">
                    <tr>
                        <td style="width: 50%;"><strong>Mã phiếu:</strong> #
                            <?=$data['code']?>
                            <?=$data['id']?>
                        </td>
                        <td style="width: 50%;"><strong>Người tạo:</strong>
                            <?=htmlspecialchars($data['user_name'])?>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>Cửa hàng:</strong>
                            <?=htmlspecialchars($data['store_name'])?>
                            <?php if(!empty($data['branch_name'])): ?> - <strong>Quầy:</strong>
                            <?=htmlspecialchars($data['branch_name'])?>
                            <?php endif; ?>
                        </td>
                        <td>
                            <strong>Trạng thái:</strong>
                            <?php
                                $type = $data['type'];
                                $receive_status = $data['receive_status'] ?? 0;
                                
                                if ($type === 'move' || $type === 'return') {
                                    $status_info = $status_map[$receive_status] ?? ['name' => 'Không xác định', 'color' => 'secondary'];
                                    echo '<span class="fw-bold p-1 rounded-3 small text-' . $status_info['color'] . '">' . $status_info['name'] . '</span>';
                                    if ($receive_status == 2 && !empty($data['receive_date'])) {
                                        echo '<small class="d-block">' . date($setting['site_datetime'] ?? 'd/m/Y H:i', strtotime($data['receive_date'])) . '</small>';
                                    }
                                } elseif ($type === 'import') {
                                    echo '<span class="fw-bold p-1 rounded-3 small text-primary">Đã nhập hàng</span>';
                                } elseif ($type === 'pairing') {
                                    echo '<span class="fw-bold p-1 rounded-3 small text-primary">Đã chỉnh sửa</span>';
                                } elseif ($type === 'cancel') {
                                    echo '<span class="fw-bold p-1 rounded-3 small text-danger">Đã hủy hàng</span>';
                                } elseif ($type === 'error' && $receive_status == 3) {
                                    echo '<span class="fw-bold p-1 rounded-3 small text-danger">Xuất kiểm kê</span>';
                                } else {
                                    echo '<span class="fw-bold p-1 rounded-3 small text-success">Đã hoàn thành</span>';
                                }
                            ?>
                        </td>
                    </tr>
                    <?php if(!empty($data['stores_receive'])): ?>
                    <tr>
                        <td colspan="2">
                            <strong>Đến Cửa hàng:</strong>
                            <?=htmlspecialchars($data['store_receive_name'])?>
                            <?php if(!empty($data['branch_receive_name'])): ?> - <strong>Quầy:</strong>
                            <?=htmlspecialchars($data['branch_receive_name'])?>
                            <?php endif; ?>
                        </td>
                    </tr>
                    <?php endif; ?>
                    <tr>
                        <td colspan="2"><strong>Nội dung:</strong>
                            <?=htmlspecialchars($data['content'])?>
                        </td>
                    </tr>
                </table>

                <div class="table-responsive">
                    <table class="table table-bordered align-middle table-sm">
                        <thead class="text-uppercase text-center">
                            <tr>
                                <th>STT</th>
                                <th><?=$jatbi->lang('Mã sản phẩm')?></th>
                                <th><?=$jatbi->lang('Sản phẩm')?></th>
                                <th><?=$jatbi->lang('Số lượng')?></th>
                                <th><?=$jatbi->lang('Đơn vị')?></th>
                                <th class="text-end"><?=$jatbi->lang('Đơn giá')?></th>
                                <th class="text-end"><?=$jatbi->lang('Thành tiền')?></th>
                                <th><?=$jatbi->lang('Ghi chú')?></th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php $stt = 0; ?>
                            <?php foreach ($details as $detail): ?>
                            <tr>
                                <td class="text-center">
                                    <?=++$stt?>
                                </td>
                                <td>
                                    <?=$detail['code']?>
                                </td>
                                <td>
                                    <?=$detail['name']?>
                                </td>
                                <td class="text-center">
                                    <?=number_format($detail['amount'], 1)?>
                                </td>
                                <td class="text-center">
                                    <?=$detail['unit_name']?>
                                </td>
                                <td class="text-end">
                                    <?=number_format($detail['price'])?>
                                </td>
                                <td class="text-end fw-bold">
                                    <?=number_format($detail['total_price'])?>
                                </td>
                                <td>
                                    <?=htmlspecialchars($detail['notes'] ?? '')?>
                                </td>
                            </tr>
                            <?php endforeach; ?>
                        </tbody>
                        <tfoot>
                            <tr class="fw-bold">
                                <td colspan="3" class="text-end"><?=$jatbi->lang('Tổng cộng')?></td>
                                <td class="text-center">
                                    <?=number_format($total_amount, 1)?>
                                </td>
                                <td></td>
                                <td></td>
                                <td class="text-end">
                                    <?=number_format($total_sum)?>
                                </td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                     <div class="mt-3">
                        <p><strong><?=$jatbi->lang('Tổng số tiền (viết bằng chữ)')?>:</strong>
                     ..............................................................
                        </p>
                        <p><strong><?=$jatbi->lang('Số chứng từ gốc kèm theo')?>:</strong>
                            ............................................................</p>
                    </div>
                    <div style="display: flex;justify-content: space-between;color:#000">
                        <div class="font-weight-bold"
                            style="display: inline-block;text-transform: uppercase;; width: 60%"></div>
                        <div class="text-center" style="display: inline-block;; width: 40%">
                            <p><span class="font-weight-bold font-italic"><i>Ngày .... Tháng .... Năm .....</i></span>
                            </p>
                        </div>
                    </div>

         <div class="mt-4">
                    <table style="width: 100%;">
                        <tr>
                            <td style="width: 33%; text-align: center;"><strong>Người Lập</strong></td>
                            <td style="width: 33%; text-align: center;"><strong>Thủ Kho</strong></td>
                            <td style="width: 33%; text-align: center;"><strong>Người Nhận</strong></td>
                        </tr>
                        <tr>
                            <td style="text-align: center;"><i>(Ký, họ tên)</i></td>
                            <td style="text-align: center;"><i>(Ký, họ tên)</i></td>
                            <td style="text-align: center;"><i>(Ký, họ tên)</i></td>
                        </tr>
                        <tr>
                            <td style="padding-top: 80px; text-align: center;">
                                <?php echo htmlspecialchars($data['user_name']); ?>
                            </td>
                            <td style="padding-top: 80px; text-align: center;"></td>
                            <td style="padding-top: 80px; text-align: center;"></td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="modal-footer d-print-none">
                <button type="button" class="btn btn-secondary"
                    data-bs-dismiss="modal"><?=$jatbi->lang('Hủy')?></button>
                <button class="btn btn-success btn-print">IN</button>
            </div>
        </div>
    </div>
</div>